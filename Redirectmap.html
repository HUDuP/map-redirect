<!DOCTYPE html>
<html>
<head>
  <title>K2 OData Google Map</title>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>

<div id="map"></div>

<script>
  let map;

  function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 8,
      center: { lat: 15.235, lng: 104.86 }
    });

    loadMarkersFromOData();
  }

  async function loadMarkersFromOData() {
    try {
      const response = await fetch(
        "https://eservices.thainamthip.co.th/api/odata/v3/SQL_GooglemapRerouting_dbo_StoreInfo?$select=Lat,Long"
      );

      const result = await response.json();

      // OData v3 returns data in result.value
      const markers = result.value.map(item => {
        return new google.maps.Marker({
          position: {
            lat: parseFloat(item.Lat),
            lng: parseFloat(item.Long)
          }
        });
      });

      // Marker clustering (important for 1000+ points)
      new markerClusterer.MarkerClusterer({ map, markers });

    } catch (err) {
      console.error("Error loading OData:", err);
      alert("Failed to load map data");
    }
  }
</script>

<!-- Google Maps API -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCrV3Y-C0wBMMqCx7Jx6Rx_Igo2e1Z4tj4&callback=initMap"
  async defer>
</script>

<!-- Marker Clusterer -->
<script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

</body>
</html>
